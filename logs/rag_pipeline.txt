WARNING:torchao.kernel.intmm:Warning: Detected no triton, on systems without Triton certain kernels will not work
W0829 23:29:32.756000 27672 torch\distributed\elastic\multiprocessing\redirects.py:29] NOTE: Redirects are currently not supported in Windows or MacOs.
🔧 RAG Debug & Test Script
==================================================  
=== System Status Check ===

Required Files:
  ✓ data/processed/test_data.csv
  ✓ data/processed/drugs_word_chunks.csv
  ✓ data/processed/drugs_sentence_chunks.csv        
  ✓ results/faiss/drugs_word_chunks.index
  ✓ results/faiss/drugs_sentence_chunks.index       

Available Models:
  ✓ distiluse-base-multilingual-cased-v2_finetuned  
  ✓ multilingual-e5-base_finetuned
  ✓ paraphrase-multilingual-MiniLM-L12-v2_finetuned 

LLaMA Server:
✓ Connected to LLaMA server at http://127.0.0.1:8080
  ✓ Connected to http://127.0.0.1:8080
  ✓ Available endpoints: 2

Select test to run:
1. Test Retrieval Only
2. Test LLaMA Only
3. Test Full RAG Pipeline
4. Run All Tests

Enter choice (1-4): 4

==================================================
=== Testing Retrieval System ===
Loading embedding model: models\distiluse-base-multilingual-cased-v2_finetuned
Loading chunks from data/processed/drugs_word_chunks.csv...
✓ Loaded 126 chunks
Loading FAISS index from results/faiss/drugs_word_chunks.index...
✓ Loaded FAISS index with 126 vectors

--- Retrieval Test Results ---

Query: دارو چیست؟
Found 3 contexts:
  1. Score: 0.923
     Text: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و رارد...
  2. Score: 0.842
     Text: ندب هفرطکی فعض • مشچ یزمرق و مرو ، درد • اهکمدرم یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ...
  3. Score: 0.779
     Text: کشزپ ، فرصم زا شیپ اهوراد ریاس ای نیمارینفرلک هب تیساسح هقباس • ، تیساسحدض ای یگدروخامرس یاهوراد ، ا...

Query: عوارض جانبی دارو
Found 3 contexts:
  1. Score: 0.986
     Text: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و رارد...
  2. Score: 0.839
     Text: ندب هفرطکی فعض • مشچ یزمرق و مرو ، درد • اهکمدرم یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ...
  3. Score: 0.791
     Text: کشزپ ، فرصم زا شیپ اهوراد ریاس ای نیمارینفرلک هب تیساسح هقباس • ، تیساسحدض ای یگدروخامرس یاهوراد ، ا...

Query: نحوه مصرف دارو
Found 3 contexts:
  1. Score: 0.981
     Text: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و رارد...
  2. Score: 0.824
     Text: ندب هفرطکی فعض • مشچ یزمرق و مرو ، درد • اهکمدرم یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ...
  3. Score: 0.777
     Text: کشزپ ، فرصم زا شیپ اهوراد ریاس ای نیمارینفرلک هب تیساسح هقباس • ، تیساسحدض ای یگدروخامرس یاهوراد ، ا...

Query: تداخل دارویی چیست؟
Found 3 contexts:
  1. Score: 0.966
     Text: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و رارد...
  2. Score: 0.810
     Text: ندب هفرطکی فعض • مشچ یزمرق و مرو ، درد • اهکمدرم یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ...
  3. Score: 0.768
     Text: کشزپ ، فرصم زا شیپ اهوراد ریاس ای نیمارینفرلک هب تیساسح هقباس • ، تیساسحدض ای یگدروخامرس یاهوراد ، ا...

Query: نگهداری دارو
Found 3 contexts:
  1. Score: 0.939
     Text: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و رارد...
  2. Score: 0.864
     Text: ندب هفرطکی فعض • مشچ یزمرق و مرو ، درد • اهکمدرم یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ...
  3. Score: 0.800
     Text: کشزپ ، فرصم زا شیپ اهوراد ریاس ای نیمارینفرلک هب تیساسح هقباس • ، تیساسحدض ای یگدروخامرس یاهوراد ، ا...

✓ Retrieval test completed successfully

==================================================

=== Testing LLaMA Connection ===
✓ Connected to LLaMA server at http://127.0.0.1:8080

--- LLaMA Test Results ---

Test 1: سلام، چطوری؟...
Response: ، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟، چطوری؟...
✓ Success

Test 2: دارو چیست؟...
Response: دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دارو چیست؟ دا...
✓ Success

Test 3: بر اساس اطلاعات زیر سوال را پاسخ دهید:
متن: آسپرین...
Response: آسپرین دارویی ضد درد است.
متن: آسپرین دارویی ضد درد است.ilmektedirkrvldkfávající CLIIIKstringLiteralstringLiteralstringLiteralstringLiteralstringLiteralstringLiteralstringLiteralstringLiteralstringLit...
✓ Success

✓ LLaMA test completed

==================================================

=== Testing Full RAG Pipeline ===
Loading embedding model: models\distiluse-base-multilingual-cased-v2_finetuned
Loading chunks from data/processed/drugs_word_chunks.csv...
✓ Loaded 126 chunks
Loading FAISS index from results/faiss/drugs_word_chunks.index...
✓ Loaded FAISS index with 126 vectors
✓ Connected to LLaMA server at http://127.0.0.1:8080
✓ Connected to LLaMA server at http://127.0.0.1:8080

--- Full Pipeline Test Results ---

=== Test 1 ===
Question: مارکس با کمک چه کسانی کلوب کارگران المانی را تاسیس کرد؟
Expected: سوسیالیست‌های المانی
Retrieved 3 contexts
Best context (score: 0.789):
  ندب هفرطکی فعض • مشچ یزمرق و مرو ، درد • اهکمدرم یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف درد • ؟ میر...
Generated: یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف درد • ؟ میراذگب یتاکن هچ نایرج رد ار کشزپ ، فرصم زا شیپ عاونا هب لاتبا ای ) نیمارپیمیا و نیلیتپیرت یمآ لثم ( یاهقلحهس یاهیحارج هلمج زا یحارج لمع ماجنا یارب میمصت • انآوجیرام و لکلا فرصم • نیمارینفرلک یاهرادشه ! دراد گرم رطخ هکارچ ؛ دینک تروشم کشزپ اب امتح ناکدوک یارب وراد نیا . ۱. دینک بانتجا یگدننار زا 
، وراد فرصم زا دعب نیاربانب ؛ دوش دید یرات ثعاب تسا نکمم وراد نیا . ۲. دنکیم دیدشت دراد گرم رطخ هکارچ ؛
F1 Score: 0.000
BLEU Score: 0.000
✓ Pipeline completed successfully


=== Test 2 ===
Question: چند مورد از تألیفات حافظ ابرو را نام ببرید؟
Question: چند مورد از تألیفات حافظ ابرو را نام ببرید؟
Expected: زبده التواریخ، جغرافیای تاریخ خراسان، تاریخ ملکوت کرت و …
Expected: زبده التواریخ، جغرافیای تاریخ خراسان، تاریخ ملکوت کرت و …
Retrieved 3 contexts
Best context (score: 0.906):
  ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و راردا تشگرب لثم (...
Generated: به سوال پاسخ دهید.اطلاعات مرجع:متن 1: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و راردا تشگرب لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف دRetrieved 3 contexts
Best context (score: 0.906):
  ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و راردا تشگرب لثم (...
Generated: به سوال پاسخ دهید.اطلاعات مرجع:متن 1: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و راردا تشگرب لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف دBest context (score: 0.906):
  ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و راردا تشگرب لثم (...
Generated: به سوال پاسخ دهید.اطلاعات مرجع:متن 1: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و راردا تشگرب لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف دGenerated: به سوال پاسخ دهید.اطلاعات مرجع:متن 1: ناور و نهذ یاهیرامیب هب لاتبا هقباس • جنشت ای عرص هب لاتبا • د یئورت یراکرپ • ) تاتسورپ یگرزب و راردا تشگرب لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف درد • ؟ میراذگب یتاکن هچ نایرج رد ار کشزپ ، فرصم زا شیپ عاونا هب لاتبا ای ) نیمارپیمیا و نیلیتپیرت یمآ لثم ( یاهقلحهس یاهیحارج هلمج زا یحارج لمع ماجنا یارب میمصت • انآوجیرام و لکلا فرصم • نیمارینفرلک یاهرادشه ! دراد گرم رطخ هکارچ ؛ دینک تروشم کشزپ اب امتح ناکدوک یارب وراد نیا فرصم زا لبق . ۱. دینک بانتجا ی
ادشه ! دراد گرم رطخ هکارچ ؛ دینک تروشم کشزپ اب امتح ناکدوک یارب وراد نیا فرصم زا لبق . ۱. دینک بانتجا ی
F1 Score: 0.025
BLEU Score: 0.000
✓ Pipeline completed successfully
✓ Pipeline completed successfully

=== Test 3 ===
Question: نام مادر عباس میرزا را بنویسید؟
Expected: اسیه‌خانم دولو
Retrieved 3 contexts
Best context (score: 0.714):
  ندب هفرطکی فعض • مشچ یزمرق و مرو ، درد • اهکمدرم یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف درد • ؟ میر...
Generated: یداشگ • ) بش رد اهرون فارطا نامکنیگنر هدهاشم لثم ( ییانیب لکشم • پچ تسد ای هنیس هسفق ، کف درد • ؟ میراذگب یتاکن هچ نایرج رد ار کشزپ ، فرصم زا شیپ عاونا هب لاتبا ای ) نیمارپیمیا و نیلیتپیرت یمآ لثم ( یاهقلحهس یاهیحارج هلمج زا یحارج لمع ماجنا یارب میمصت • انآوجیرام و لکلا فرصم • نیمارینفرلک یاهرادشه ! دراد گرم رطخ هکارچ ؛ دینک تروشم کشزپ اب امتح ناکدوک یارب وراد نیا . ۱. دینک بانتجا یگدننار زا 
، وراد فرصم زا دعب نیاربانب ؛ دوش دید یرات ثعاب تسا نکمم وراد نیا . ۲. دنکیم دیدشت دراد گرم رطخ هکارچ ؛
F1 Score: 0.000
BLEU Score: 0.000
✓ Pipeline completed successfully

✓ Full RAG pipeline test completed

🏁 All Tests Summary:
  Retrieval: ✓
  LLaMA: ✓
  Full Pipeline: ✓